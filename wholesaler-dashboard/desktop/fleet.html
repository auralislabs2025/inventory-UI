<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fleet Management – InventoryPro</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .fleet-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .vehicle-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border-left: 4px solid #4361ee;
    }
    .vehicle-card.assigned { border-left-color: #ff9f1c; }
    .vehicle-card.on-route { border-left-color: #06d6a0; }
    .vehicle-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .vehicle-name {
      font-size: 1.2rem;
      font-weight: 700;
      color: #2c3e50;
    }
    .vehicle-type {
      background: #e3f2fd;
      color: #1976d2;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    .vehicle-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 12px 0;
      font-size: 0.9rem;
    }
    .vehicle-detail {
      display: flex;
      flex-direction: column;
    }
    .vehicle-detail label {
      color: #6b7280;
      font-size: 0.8rem;
      margin-bottom: 4px;
    }
    .vehicle-detail strong {
      color: #1f2937;
      font-size: 1rem;
    }
    .vehicle-status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-top: 8px;
    }
    .status-available { background: #d4edda; color: #155724; }
    .status-assigned { background: #fff3cd; color: #856404; }
    .status-on-route { background: #d1ecf1; color: #0c5460; }
    .vehicle-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    .btn-sm {
      padding: 6px 12px;
      font-size: 0.85rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 500;
    }
    .btn-primary { background: #4361ee; color: white; }
    .btn-success { background: #06d6a0; color: white; }
    .btn-danger { background: #ef476f; color: white; }
    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 25px;
    }
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #4361ee;
      margin: 8px 0;
    }
    .stat-label {
      color: #6b7280;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>

<div class="app">
  <aside class="sidebar">
    <h2>InventoryPro</h2>
    <ul>
      <li><a href="index.html">Dashboard</a></li>
      <li><a href="orders.html">Orders</a></li>
      <li><a href="index.html">Route Planner</a></li>
      <li><a href="retailers.html">Retailers</a></li>
      <li><a href="inventory.html">Inventory</a></li>
      <li><a href="reports.html">Reports</a></li>
      <li class="active"><a href="fleet.html">Fleet</a></li>
      <li><a href="settings.html">Settings</a></li>
    </ul>
  </aside>

  <main class="main">
    <header class="topbar">
      <h1>Fleet Management</h1>
      <div style="display: flex; align-items: center; gap: 15px;">
        <div class="user">Wholesaler Admin</div>
        <button onclick="logout()" style="padding: 8px 16px; border: 1px solid #e5e7eb; border-radius: 6px; background: white; cursor: pointer; font-size: 0.9rem; transition: all 0.2s;" onmouseover="this.style.borderColor='#ef476f'; this.style.color='#ef476f'" onmouseout="this.style.borderColor='#e5e7eb'; this.style.color='inherit'">Logout</button>
      </div>
    </header>

    <section style="padding: 20px;">
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-label">Total Vehicles</div>
          <div class="stat-value" id="totalVehicles">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Available</div>
          <div class="stat-value" id="availableVehicles" style="color: #06d6a0;">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Assigned</div>
          <div class="stat-value" id="assignedVehicles" style="color: #ff9f1c;">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">On Route</div>
          <div class="stat-value" id="onRouteVehicles" style="color: #4361ee;">0</div>
        </div>
      </div>

      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>Vehicle Fleet</h2>
        <button class="btn btn-primary" onclick="openAddVehicleModal()">+ Add Vehicle</button>
      </div>

      <div class="fleet-grid" id="fleetGrid"></div>
    </section>
  </main>
</div>

<!-- Add Vehicle Modal -->
<div id="vehicleModal" class="modal">
  <div class="modal-content" style="max-width: 500px;">
    <button class="close-modal" onclick="closeModal()">✖</button>
    <h2 id="modalTitle">Add Vehicle</h2>
    <form onsubmit="saveVehicle(event)">
      <input type="hidden" id="vehicleId">
      <div class="form-group">
        <label>Vehicle Name/ID</label>
        <input type="text" id="vehicleName" required>
      </div>
      <div class="form-group">
        <label>Type</label>
        <select id="vehicleType" required>
          <option>Van</option>
          <option>Mini Truck</option>
          <option>Truck</option>
        </select>
      </div>
      <div class="form-group">
        <label>Capacity (kg)</label>
        <input type="number" id="vehicleCapacity" required>
      </div>
      <div class="form-group">
        <label>Cost per KM (₹)</label>
        <input type="number" step="0.01" id="vehicleCost" required>
      </div>
      <div class="form-group">
        <label>Warehouse</label>
        <select id="vehicleWarehouse" required></select>
      </div>
      <button type="submit" class="btn btn-primary">Save Vehicle</button>
    </form>
  </div>
</div>

<script src="auth.js"></script>
<script>
  // Dummy Fleet Data
  let fleet = JSON.parse(localStorage.getItem('wholesaler_fleet')) || [
    { id: 1, name: "Van-001", type: "Van", capacity: 500, costPerKm: 8, status: "available", assignedRoute: null, warehouseId: 1 },
    { id: 2, name: "Truck-002", type: "Mini Truck", capacity: 1500, costPerKm: 12, status: "available", assignedRoute: null, warehouseId: 1 },
    { id: 3, name: "Van-003", type: "Van", capacity: 500, costPerKm: 8, status: "assigned", assignedRoute: "Attingal Route", warehouseId: 1 },
    { id: 4, name: "Truck-004", type: "Truck", capacity: 3000, costPerKm: 15, status: "on_route", assignedRoute: "Varkala Route", warehouseId: 1 },
    { id: 5, name: "Van-005", type: "Van", capacity: 500, costPerKm: 8, status: "available", assignedRoute: null, warehouseId: 2 },
    { id: 6, name: "Truck-006", type: "Truck", capacity: 3000, costPerKm: 15, status: "available", assignedRoute: null, warehouseId: 3 }
  ];

  const warehouses = [
    { id: 1, name: "Trivandrum Central Godown" },
    { id: 2, name: "Attingal Depot" },
    { id: 3, name: "Nedumangad Hub" }
  ];

  function renderFleet() {
    const grid = document.getElementById("fleetGrid");
    grid.innerHTML = "";
    
    fleet.forEach(v => {
      const card = document.createElement("div");
      card.className = `vehicle-card ${v.status === 'assigned' ? 'assigned' : v.status === 'on_route' ? 'on-route' : ''}`;
      
      card.innerHTML = `
        <div class="vehicle-header">
          <div class="vehicle-name">${v.name}</div>
          <div class="vehicle-type">${v.type}</div>
        </div>
        <div class="vehicle-details">
          <div class="vehicle-detail">
            <label>Capacity</label>
            <strong>${v.capacity} kg</strong>
          </div>
          <div class="vehicle-detail">
            <label>Cost/KM</label>
            <strong>₹${v.costPerKm}</strong>
          </div>
          <div class="vehicle-detail">
            <label>Warehouse</label>
            <strong>${warehouses.find(w => w.id === v.warehouseId)?.name || 'Unknown'}</strong>
          </div>
          <div class="vehicle-detail">
            <label>Status</label>
            <span class="vehicle-status status-${v.status}">${v.status.replace('_', ' ').toUpperCase()}</span>
          </div>
        </div>
        ${v.assignedRoute ? `<div style="margin-top: 8px; font-size: 0.85rem; color: #6b7280;">Route: <strong>${v.assignedRoute}</strong></div>` : ''}
        <div class="vehicle-actions">
          <button class="btn-sm btn-primary" onclick="editVehicle(${v.id})">Edit</button>
          <button class="btn-sm btn-success" onclick="viewVehicleHistory(${v.id})">History</button>
          <button class="btn-sm btn-danger" onclick="deleteVehicle(${v.id})">Delete</button>
        </div>
      `;
      
      grid.appendChild(card);
    });
    
    updateStats();
  }

  function updateStats() {
    document.getElementById("totalVehicles").textContent = fleet.length;
    document.getElementById("availableVehicles").textContent = fleet.filter(v => v.status === "available").length;
    document.getElementById("assignedVehicles").textContent = fleet.filter(v => v.status === "assigned").length;
    document.getElementById("onRouteVehicles").textContent = fleet.filter(v => v.status === "on_route").length;
  }

  function openAddVehicleModal() {
    document.getElementById("modalTitle").textContent = "Add Vehicle";
    document.getElementById("vehicleId").value = "";
    document.querySelector("#vehicleModal form").reset();
    
    const warehouseSelect = document.getElementById("vehicleWarehouse");
    warehouseSelect.innerHTML = "";
    warehouses.forEach(w => {
      const opt = document.createElement("option");
      opt.value = w.id;
      opt.textContent = w.name;
      warehouseSelect.appendChild(opt);
    });
    
    document.getElementById("vehicleModal").classList.add("open");
  }

  function editVehicle(id) {
    const v = fleet.find(f => f.id === id);
    if (!v) return;
    
    document.getElementById("modalTitle").textContent = "Edit Vehicle";
    document.getElementById("vehicleId").value = v.id;
    document.getElementById("vehicleName").value = v.name;
    document.getElementById("vehicleType").value = v.type;
    document.getElementById("vehicleCapacity").value = v.capacity;
    document.getElementById("vehicleCost").value = v.costPerKm;
    
    const warehouseSelect = document.getElementById("vehicleWarehouse");
    warehouseSelect.innerHTML = "";
    warehouses.forEach(w => {
      const opt = document.createElement("option");
      opt.value = w.id;
      opt.textContent = w.name;
      opt.selected = w.id === v.warehouseId;
      warehouseSelect.appendChild(opt);
    });
    
    document.getElementById("vehicleModal").classList.add("open");
  }

  function saveVehicle(e) {
    e.preventDefault();
    const id = document.getElementById("vehicleId").value;
    const vehicle = {
      id: id ? parseInt(id) : Date.now(),
      name: document.getElementById("vehicleName").value,
      type: document.getElementById("vehicleType").value,
      capacity: parseInt(document.getElementById("vehicleCapacity").value),
      costPerKm: parseFloat(document.getElementById("vehicleCost").value),
      warehouseId: parseInt(document.getElementById("vehicleWarehouse").value),
      status: id ? fleet.find(f => f.id === parseInt(id)).status : "available",
      assignedRoute: id ? fleet.find(f => f.id === parseInt(id)).assignedRoute : null
    };
    
    if (id) {
      fleet = fleet.map(f => f.id === vehicle.id ? vehicle : f);
    } else {
      fleet.push(vehicle);
    }
    
    localStorage.setItem('wholesaler_fleet', JSON.stringify(fleet));
    renderFleet();
    closeModal();
    alert("Vehicle saved successfully!");
  }

  function deleteVehicle(id) {
    if (confirm("Delete this vehicle?")) {
      fleet = fleet.filter(f => f.id !== id);
      localStorage.setItem('wholesaler_fleet', JSON.stringify(fleet));
      renderFleet();
    }
  }

  function viewVehicleHistory(id) {
    alert("Vehicle history feature - to be implemented");
  }

  function closeModal() {
    document.getElementById("vehicleModal").classList.remove("open");
  }

  renderFleet();
  
  // Close modal on backdrop click
  document.getElementById('vehicleModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeModal();
    }
  });
</script>
</body>
</html>

