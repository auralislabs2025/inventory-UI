<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Adjustments - InventoryPro</title>
  <style>
    :root {
      --primary:#4361ee; --success:#06d6a0; --warning:#ff9f1c; --danger:#ef476f;
      --dark:#2c3e50; --light:#f8f9fa; --gray:#adb5bd;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#f8f9fa;color:#333}
    .app{display:flex;min-height:100vh}
    .sidebar{width:260px;background:#2c3e50;color:white;padding:20px 0;flex-shrink:0}
    .sidebar .logo{padding:0 25px;font-size:1.6rem;font-weight:bold;margin-bottom:30px}
    .sidebar ul{list-style:none}
    .sidebar li a{display:block;padding:15px 25px;color:white;text-decoration:none}
    .sidebar li.active,.sidebar li:hover{background:#34495e}
    .main{flex:1}
    .topbar{display:flex;justify-content:space-between;align-items:center;padding:15px 30px;background:white;box-shadow:0 2px 15px rgba(0,0,0,0.1)}
    .topbar button{background:none;border:none;font-size:1.5rem;cursor:pointer}
    .global-search{width:380px;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:1rem}
    .content{padding:30px}
    h1{color:#2c3e50;margin-bottom:25px;font-size:1.8rem}
    .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}
    .btn{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:500;font-size:0.95rem}
    .btn-primary{background:var(--primary);color:white}
    .btn-success{background:var(--success);color:white}
    .btn-danger{background:var(--danger);color:white}
    .btn-sm{padding:6px 12px;font-size:0.85rem}
    .search-bar{width:100%;padding:14px;border:1px solid #ddd;border-radius:8px;margin-bottom:20px;font-size:1rem}
    .table-container{background:white;border-radius:12px;overflow:hidden;box-shadow:0 5px 20px rgba(0,0,0,0.1)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:16px;text-align:left;border-bottom:1px solid #eee}
    th{background:#f8f9fa;font-weight:600;color:#555}
    tr:hover{background:#f8f9fa}
    .reason-restock{background:#d4edda;color:#155724}
    .reason-damage{background:#f8d7da;color:#721c24}
    .reason-lost{background:#fff3cd;color:#856404}
    .reason-correction{background:#e2e3e5;color:#41464b}
    .reason-received{background:#d1ecf1;color:#0c5460}
    .reason{padding:6px 12px;border-radius:20px;font-size:0.85rem;font-weight:500}
    .change-positive{color:var(--success);font-weight:bold}
    .change-negative{color:var(--danger);font-weight:bold}
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:2000;justify-content:center;align-items:center}
    .modal.open{display:flex}
    .modal-content{background:white;padding:30px;border-radius:12px;width:90%;max-width:600px;max-height:90vh;overflow-y:auto;position:relative;box-shadow:0 15px 50px rgba(0,0,0,0.25)}
    .close-modal{position:absolute;top:15px;right:20px;background:none;border:none;font-size:32px;cursor:pointer;color:#999}
    .close-modal:hover{color:#333}
    .form-group{margin-bottom:20px}
    .form-group label{display:block;margin-bottom:8px;font-weight:500;color:#444}
    .form-group input,.form-group select{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:1rem}
    .toast{position:fixed;bottom:30px;right:30px;background:#333;color:white;padding:16px 28px;border-radius:8px;opacity:0;transition:.3s;z-index:3000;box-shadow:0 5px 20px rgba(0,0,0,0.3);font-size:1rem}
    .toast.show{opacity:1;transform:translateY(-10px)}
    @media(max-width:768px){
      .sidebar{position:fixed;left:-260px;z-index:999;transition:.3s}
      .sidebar.open{left:0}
      .global-search{width:100%;margin:10px 0}
      .page-header{flex-direction:column;align-items:flex-start;gap:15px}
    }
  </style>
</head>
<body>

<div class="app">
  <aside class="sidebar" id="sidebar">
    <div class="logo">InventoryPro</div>
    <ul>
      <li><a href="index.html">Dashboard</a></li>
      <li><a href="inventory.html">Inventory</a></li>
      <li><a href="suppliers.html">Suppliers</a></li>
      <li><a href="purchases.html">Purchases</a></li>
      <li class="active"><a href="adjustments.html">Adjustments</a></li>
      <li><a href="reports.html">Reports</a></li>
      <li><a href="settings.html">Settings</a></li>
    </ul>
  </aside>

  <div class="main">
    <header class="topbar">
      <button onclick="document.getElementById('sidebar').classList.toggle('open')">Menu</button>
      <input type="text" placeholder="Search adjustments..." class="global-search">
      <div>
        <select onchange="document.body.className=this.value;localStorage.setItem('theme',this.value)">
          <option value="">Light</option>
          <option value="dark">Dark</option>
        </select>
        <span style="margin-left:20px;background:var(--primary);color:white;padding:10px 14px;border-radius:50%;font-weight:bold">AD</span>
      </div>
    </header>

    <main class="content">
      <div class="page-header">
        <h1>Stock Adjustments</h1>
        <button class="btn btn-primary" onclick="openManualModal()">+ Manual Adjustment</button>
      </div>

      <input type="text" class="search-bar" placeholder="Search by item, reason, user..." id="searchInput" onkeyup="filterAdjustments()">

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Item SKU</th>
              <th>Item Name</th>
              <th>Change</th>
              <th>Reason</th>
              <th>User / Source</th>
            </tr>
          </thead>
          <tbody id="adjustmentsBody">
            <!-- Filled by JS -->
          </tbody>
        </table>
      </div>

      <div style="margin-top:20px;text-align:center;color:#666">
        Total Adjustments: <strong id="totalCount">0</strong>
      </div>
    </main>
  </div>

  <!-- Manual Adjustment Modal -->
  <div class="modal" id="adjustModal">
    <div class="modal-content">
      <button class="close-modal" onclick="closeModal()">X</button>
      <h2>Manual Stock Adjustment</h2>
      <form onsubmit="saveManualAdjustment(event)">
        <div class="form-group">
          <label>Item SKU</label>
          <input type="text" id="adjSKU" required placeholder="e.g. SKU-001">
        </div>
        <div class="form-group">
          <label>Item Name</label>
          <input type="text" id="adjName" required>
        </div>
        <div class="form-group">
          <label>Adjustment</label>
          <input type="number" id="adjChange" required placeholder="+10 or -5">
        </div>
        <div class="form-group">
          <label>Reason</label>
          <select id="adjReason">
            <option>Restock</option>
            <option>Damage</option>
            <option>Lost/Theft</option>
            <option>Correction</option>
            <option>Expired</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary">Apply Adjustment</button>
      </form>
    </div>
  </div>

  <div id="toast" class="toast"></div>
</div>

<script>
  // Global adjustment history (shared across pages)
  let adjustments = JSON.parse(localStorage.getItem('adjustments')) || [
    {date:"2025-12-08", sku:"SKU-001", name:"Laptop Dell XPS", change:+100, reason:"received", source:"PO-2025-001"},
    {date:"2025-12-06", sku:"SKU-002", name:"Wireless Mouse", change:-92, reason:"sale", source:"Sales"},
    {date:"2025-12-01", sku:"SKU-001", name:"Laptop Dell XPS", change:+50, reason:"restock", source:"Manual"},
    {date:"2025-11-28", sku:"SKU-003", name:"USB-C Hub", change:-15, reason:"damage", source:"Manual"}
  ];

  function renderAdjustments() {
    const tbody = document.getElementById('adjustmentsBody');
    tbody.innerHTML = adjustments
      .sort((a,b) => new Date(b.date) - new Date(a.date))
      .map(adj => {
        const changeClass = adj.change > 0 ? 'change-positive' : 'change-negative';
        const reasonClass = `reason-${adj.reason.toLowerCase()}`;
        return `
          <tr>
            <td>${adj.date}</td>
            <td><strong>${adj.sku}</strong></td>
            <td>${adj.name}</td>
            <td class="${changeClass}">${adj.change > 0 ? '+' : ''}${adj.change}</td>
            <td><span class="reason ${reasonClass}">${adj.reason.charAt(0).toUpperCase() + adj.reason.slice(1)}</span></td>
            <td>${adj.source}</td>
          </tr>
        `;
      }).join('');
    document.getElementById('totalCount').textContent = adjustments.length;
  }

  function openManualModal() {
    document.getElementById('adjustModal').querySelector('form').reset();
    openModal('adjustModal');
  }

  function saveManualAdjustment(e) {
    e.preventDefault();
    const adj = {
      date: new Date().toISOString().slice(0,10),
      sku: document.getElementById('adjSKU').value.trim(),
      name: document.getElementById('adjName').value.trim(),
      change: parseInt(document.getElementById('adjChange').value),
      reason: document.getElementById('adjReason').value.toLowerCase(),
      source: "Manual"
    };

    adjustments.unshift(adj);
    localStorage.setItem('adjustments', JSON.stringify(adjustments));

    // Also update inventory quantity if exists
    let inventory = JSON.parse(localStorage.getItem('inventory') || '[]');
    const item = inventory.find(i => i.sku === adj.sku);
    if (item) {
      item.quantity = (item.quantity || 0) + adj.change;
      localStorage.setItem('inventory', JSON.stringify(inventory));
    }

    showToast(`Adjustment of ${adj.change > 0 ? '+' : ''}${adj.change} applied!`);
    renderAdjustments();
    closeModal();
  }

  function filterAdjustments() {
    const term = document.getElementById('searchInput').value.toLowerCase();
    document.querySelectorAll('#adjustmentsBody tr').forEach(row => {
      row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none';
    });
  }

  function openModal(id){ document.getElementById(id).classList.add('open'); }
  function closeModal(){ document.querySelectorAll('.modal').forEach(m=>m.classList.remove('open')); }
  function showToast(msg){
    const t=document.getElementById('toast');
    t.textContent=msg;
    t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'),3000);
  }

  document.querySelectorAll('.modal').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)closeModal();}));
  document.body.className = localStorage.getItem('theme')||'';
  renderAdjustments();
</script>
</body>
</html>